execute unless entity @s[nbt={SelectedItem:{components:{upgradable:1b}}},predicate=lbc:sneak] run function lbc:workingitems/sauvojen_staffs/terra_preloop
execute at @s[nbt={SelectedItem:{components:{upgradable:1b}}},predicate=lbc:sneak] if block ~ ~-1 ~ grass_block run function lbc:workingitems/sauvojen_staffs/terra_preloop_check_upgrade
execute at @s[nbt={SelectedItem:{components:{upgradable:1b}}},predicate=lbc:sneak] unless block ~ ~-1 ~ grass_block run tellraw @s {"translate":"not_on_grass"}
scoreboard players operation @s mana -= stterra_wand_mana_use lbc.math
scoreboard players operation @s[nbt={Inventory:[{Slot:100b,components:{"mage": true}},{Slot:101b,components:{"mage": true}},{Slot:102b,components:{"mage": true}},{Slot:103b,components:{"mage": true}}]}] manamax += mage_set_bonus lbc.math